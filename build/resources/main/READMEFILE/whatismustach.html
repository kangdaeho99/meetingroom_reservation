<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>What is mustach</title>
</head>
<body>
머스테치(Mustache)를 통해 화면영역을 개발하는 방법을 배워보겠습니다.
서버 템플릿 엔진과 클라이언트 템플릿 엔진의 차이는 무엇인지, 이 책에서는 왜 JSP가 아닌 머스테치를 선택했는지,
머스테치를 통해 기본적인 CRUD 화면 개방방법 등을 차례로 진행해봅니다.

4.1 서버 템플릿엔진과 머스테치 소개
먼저 템플릿엔진이란 무엇인가?
일반적으로 웹개발에 있어 템플릿 엔진이란, 지정된 템플릿 양시과 데이터가 합쳐져 HTML 문서를 출력하는 소프트웨어를 이야기합니다.
예전에 스프링이나 서블릿을 사용해본 독자들은 아마도 JSP, FreeMarker등을 떠올리고,
요즘 개발을 시작한 독자들은 리액트, 뷰의 view파일들을 떠올릴것입니다.
둘 모두 결과적으로 지정된 템플릿과 데이터를 이용하여 HTML을 생성하는 템플릿 엔진입니다.
다만, 조금의 차이가 있습니다. 전자는 서버 템플릿 엔진이라 불리며, 후자는 클라이언트 템플릿 엔진이라 불립니다.
개발을 시작하는 많은 개발자들이 이 둘 간에 많은 오해를 합니다.
예로 다음과 같은 질문이 커뮤니티에 종종 올라옵니다.
자바스크립트에서 JSP나 FreeMaker처럼 자바코드를 사용할 수 있나요?
예시코드는 다음과 같습니다.
<script type="text/javascript">
$(document).ready(function(){
    if(a=="1"){
    <%
        System.out.println("test");
    %>
    }
});
</script>

이 코드는 if문과 관계없이 무조건 test를 콘솔에 출력합니다.
이유는 프론트엔드의 자바스크립트(NodeJS가 아닙니다.)가 작동하는 영역과 JSP가 작동하는 영역이 다르기 때문인데
JSP를 비롯한 서버 템플릿 엔진은 서버에서 구동됩니다.
JSP는 명확하게는 서버 템플릿 엔진은 아닙니다만, View의 역할만 하도록 구성할때는 템플릿 엔진으로써 사용할 수 있습니다.
이 경우엔 Spring + JSP로 사용한 경우로 보면 됩니다.
서버템플릿 엔진을 이용한 화면 생성은 서버에서 Java 코드로 문자열을 만든뒤 이 문자열을 HTML로 변환하여 브라우저로 전달합니다.
앞선 코드는 HTML 을 만드는 과정에서 System.out.println("test")를 실행할뿐이며, 이때의 자바스크립트 코드는 단순한 문자열일 뿐입니다.
반면에 자바스크립트는 브라우저 위에서 작동합니다.
앞에서 작성된 자바스크립트 코드가 실행되는 장소는 서버가 아닌 브라우저입니다.
즉, 브라우저에서 작동될때는 서버 템플릿 엔진의 손을 벗어나 제어할 수가 없습니다.
흔히 이야기하는 Vuew.js나 React.js 를 이용한 SPA(Single Page Application)는 브라우저에서 화면을 생성합니다.
즉, 서버에서 이미 코드가 벗어난 경우입니다.
그래서 다음과 같이 서버에서는 Json 혹은 XML 형식의 데이터만 전달하고 클라이언트에서 조리합니다.

물론 최근데 리액트나 뷰와 같은 자바스크립트 프레임워크에서 서버사이드 렌더링을 지원하는 모습을 볼 수 있습니다만, 여기까지 이야기하기에는
책의 범위에서 벗어납니다.
대신 간단하게 설명하자면, 자바스크립트 프레임워크의 화면 생성 방식을 서버에서 실행하는 것을 이야기합니다.
이는 V8 엔진 라이브러리들이 지원하기 때문이며, 스프링 부트에서 사용할 수 있는 대표적인 기술들로는 Nashorn, J2V8 이 있습니다.
다만 스프링 부트를 사용하면서 자바스크립트를 서버사이드에서 렌더링 하도록 구현하는것은 많은 수고가 필요하므로 시작하는 단계에서 추천하지는 않습니다.
스프링 부트에 대한 이해도와 자바스크립트 프레임워크 양쪽에 대한 이해도가 높아졌을때 시도해보면 좋습니다.

머스테치란
머스테치는 (http://mustache.github.io/) 수많은 언어를 지원하는 가장 심플한 템플릿 엔진입니다.
JSP와 같이 HTML을 만들어주는 템플릿 엔진입니다.
루비, 자바스크립트, 파이썬, PHP, 자바, 펄, Go, ASP 등 현존하는 대부분 언어를 지원하고 있습니다.
그러다보니 자바에서 사용될때는 서버 템플릿 엔진으로, 자바스크립트에서 사용될때는 클라이언트 템플릿 엔진으로 모두 사용할 수 있습니다.
자바 진영에서는 JSP, Velocity, Freemarker, Thymeleaf 등 다양한 서버 템플릿 엔진이 존재합니다.
필자가 생각하는 템플릿 엔진들의 단점은 다음과 같습니다.
-JSP, Velocity : 스프링 부트에서는 권장하지 않는 템플릿 엔진입니다.
-Freemarker : 템플릿 엔진으로는 너무 과하게 많은 기능을 지원합니다.
높은 자유도로 인해 숙련도가 낮을 수록 Freemarker안에 비즈니스 로직이 추가될 확률이 높습니다.
-Thymeleaf: 스프링 진영에서 적극적으로 밀고 있지만 문법이 어렵습니다. HTML 태그에 속성으로 템플릿 기능을 사용하는 방식이
기존 개발자분들께 높은 허들로 느껴지는 경우가 많습니다. 실제로 사용해본 분들은 자바스크립트 프레임워크를 배우는 기분이라고 후기를 이야기하기도
합니다. 물론 Vuew.js를 사용해본 경험이 있어 태그속성 방식이 익숙한 분이라면 Thymeleaf를 선택해도 됩니다.

반면 머스테치의 장점은 다음과 같습니다.
-문법이 다른 템플릿 엔진보다 심플합니다.
-로직코드를 사용할 수 없어 View의 역할과 서버의 역할이 명확하게 분리됩니다.
-Mustache.js와 Mustache.java 2가지가 다 있어, 하나의 문법으로 클라이언트/서버 템플릿을 모두 사용 가능합니다.
개인적으로 템플릿 엔진은 화면 역할에만 충실해야한다고 생각합니다.
너무 많은 기능을 제공하면 API와 템플릿 엔진, 자바스크립트가 서로 로직을 나눠 갖게되어 유지보수하기가 굉장히 어렵습니다.

---
머스테치 플러그인설치
앞에서 언급한 장점외에 머스테치를 사용할때 장점이 한가지 더 있습니다.
그건 바로 인텔리제이 커뮤니티 버전을 사용해도 플러그인을 사용할 수 있다는 것입니다.
Thymeleaf나 JSP등은 커뮤니티 버전에서 지원하지 않고 인텔리제이 얼티메이트 버전(유료)에서만 공식 지원합니다.
머스테치는 이와 달리 커뮤니티 버전에서도 설치 가능한 플러그인이 있습니다.
그래서 커뮤니티 버전을 사용하는 개발자들은 특히나 머스테치를 사용하는것이 좋습니다.
이 플러그인을 이용하면 머스테치의 문법체크, HTML 문법지원, 자동완성 등이 지원되니 개발할때 큰 도움을 받을 수 있습니다.
다음과 같이 'mustache'를 검색해서 해당 플러그인을 설치하면 됩니다.

설치가 완료되면 인텔리제이를 재식하여 플러그인이 작동하는 것을 확인하면 됩니다.
implementation('org.springframework.boot:spring-boot-starter-mustache')
보는 것처럼 머스테치는 스프링부트에서 공식 지원하는 템플릿 엔진입니다.
의존성 하나만 추가하면 다른 스타터 패키지와 마찬가지로 추가 설정없이 설치가 끝입니다.
별도로 스프링 부트 버전을 개발자가 신경쓰지 않아도 되는 장점도 있습니다.
머스테치의 파일 위치는 기본적으로 src/main/resources/templates 입니다.
이 위치에 머스테치 파일을 두면 스프링 부트에서 자동으로 로딩합니다.
첫 페이지를 담당할 index.mustache를 src/main/resources/templates에 생성합니다.

코드는 직접 추가해야합니다.
<!DOCTYPE HTML>
<html>
<head>
    <title>스프링 부트 웹서비스</title>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />

</head>
<body>
<h1>스프링 부트로 시작하는 웹 서비스</h1>
</body>
</html>

간단하게 h1 크기로 '스프링 부트로 시작하는 웹 서비스'르 출력하는 페이지입니다.
이 머스테치에 URL을 매핑합니다.
URL 매핑은 당연하게 Controller에서 진행합니다. web 패키지 안에 Index Controller를 생성합니다.



</body>
</html>